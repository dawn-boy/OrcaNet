<div id="master-table-container">
    <div class="flex justify-end mb-2">
        <div class="flex items-center space-x-2 text-sm">
            <label for="per-page" class="text-gray-400">Rows per page:</label>
            <select name="per_page" id="per-page" class="bg-gray-700 border border-gray-600 rounded-md p-1"
                    hx-get="{{ url_for('routes.results_table', task_id=task_id, page=1, sort_by=sort_by, sort_order=sort_order) }}"
                    hx-target="#master-table-container"
                    hx-swap="outerHTML"
                    hx-indicator="#global-spinner">
                {% for size in [10, 25, 50, 100] %}
                <option value="{{ size }}" {% if size == per_page %}selected{% endif %}>{{ size }}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-700">
            <thead class="bg-gray-700">
                <tr>
                    {% set headers = contigs[0].keys() if contigs else [] %}
                    {% for header in headers %}
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">
                        <a class="cursor-pointer hover:text-cyan-400"
                           hx-get="{{ url_for('routes.results_table', task_id=task_id, page=1, per_page=per_page, sort_by=header, sort_order='asc' if (sort_by == header and sort_order == 'desc') else 'desc') }}"
                           hx-target="#master-table-container"
                           hx-swap="outerHTML"
                           hx-indicator="#global-spinner">
                           {{ header.replace('_', ' ') }}
                           {% if sort_by == header %}{{ '▾' if sort_order == 'desc' else '▴' }}{% endif %}
                        </a>
                    </th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody class="bg-gray-800 divide-y divide-gray-600">
                {% for row in contigs %}
           <tr class="cursor-pointer hover:bg-gray-700 transition-colors"
                hx-get="{{ url_for('routes.update_details', task_id=task_id, contig_id=row.contig_id) }}"                hx-target="#novelty-card-content"
                hx-swap="innerHTML">
               {% for cell in row.values() %}
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                                    {% if cell is number %}
                {{ cell | round(2) }}
            {% else %}
                {{ cell }}
            {% endif %}
                    </td>

                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="flex justify-center items-center mt-4 space-x-1 text-sm">
        {% if page > 1 %}<a class="px-3 py-2 rounded bg-gray-600 hover:bg-gray-500" hx-get="{{ url_for('routes.results_table', task_id=task_id, page=1, per_page=per_page, sort_by=sort_by, sort_order=sort_order) }}" hx-target="#master-table-container" hx-swap="outerHTML">&laquo; First</a>{% endif %}

        {% set start_page = [1, page - 2] | max %}{% set end_page = [start_page + 4, total_pages] | min %}{% set start_page = [1, end_page - 4] | max %}
        {% for p in range(start_page, end_page + 1) %}
            <a class="px-3 py-2 rounded {{ 'bg-blue-600 text-white' if p == page else 'bg-gray-600 hover:bg-gray-500' }}" hx-get="{{ url_for('routes.results_table', task_id=task_id, page=p, per_page=per_page, sort_by=sort_by, sort_order=sort_order) }}" hx-target="#master-table-container" hx-swap="outerHTML">{{ p }}</a>
        {% endfor %}

        {% if page < total_pages %}<a class="px-3 py-2 rounded bg-gray-600 hover:bg-gray-500" hx-get="{{ url_for('routes.results_table', task_id=task_id, page=total_pages, per_page=per_page, sort_by=sort_by, sort_order=sort_order) }}" hx-target="#master-table-container" hx-swap="outerHTML">Last &raquo;</a>{% endif %}
    </div>
</div>